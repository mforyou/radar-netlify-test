<script>
async function loadData() {
  try {
    $status.textContent = "Ładowanie…";

    // cache-busting, aby zawsze pobierać świeże dane
    const url = API_URL + (API_URL.includes("?") ? "&" : "?") + "_=" + Date.now();

    const res = await fetch(url, { cache: "no-store" });
    if (!res.ok) throw new Error("HTTP " + res.status);

    const data = await res.json();
    renderTable(data);

    $time.textContent = "Ostatnia aktualizacja: " + new Date().toLocaleString("pl-PL");
    $status.textContent = "";
  } catch (err) {
    console.error(err);
    $status.innerHTML = `<span class="error">Błąd pobierania danych: ${err.message}</span>`;
    if (!$body.querySelector("tr")) {
      $body.innerHTML = `<tr><td class="empty" colspan="7">Brak danych.</td></tr>`;
    }
  }
}
</script>
