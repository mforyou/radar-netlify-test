<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ArkoRadar 3000 ULTRA</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; background:#0c1622; color:#e6f1ff; margin:0}
    .wrap{max-width:1100px; margin:24px auto; padding:0 12px}
    h1{color:#35e06f; margin:0 0 10px}
    .bar{display:flex; gap:10px; align-items:center; margin:8px 0 14px}
    .btn{background:#123; color:#e6f1ff; border:1px solid #2b3e55; padding:6px 10px; border-radius:8px; cursor:pointer}
    .btn:disabled{opacity:.6; cursor:default}
    .note{opacity:.8; font-size:13px}
    .err{color:#ff6b6b; font-weight:600}
    table{width:100%; border-collapse:collapse; background:rgba(255,255,255,.04); border-radius:10px; overflow:hidden}
    th,td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.07)}
    th{text-align:left; color:#7fc8ff; letter-spacing:.2px; font-weight:600}
    tr:hover td{background:rgba(255,255,255,.03)}
    .right{text-align:right}
    .muted{opacity:.7}
    .badge{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #2b3e55}
    .ok{color:#36e072}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ArkoRadar 3000 ULTRA</h1>
    <div class="bar">
      <button id="btn" class="btn">Odśwież</button>
      <label><input type="checkbox" id="onlyToday" checked> Widok: dziś</label>
      <span class="note">sort: <strong>Prob ↓</strong></span>
    </div>
    <div id="status" class="note muted">—</div>

    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>League</th>
          <th>Home</th>
          <th>Away</th>
          <th>Typ</th>
          <th class="right">Prob</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tbody">
        <tr><td colspan="7" class="muted">ładowanie…</td></tr>
      </tbody>
    </table>

    <p class="muted" style="margin-top:10px">© ArkoRadar</p>
  </div>

  <script>
    // ⬇⬇ WSTAW TU SWÓJ DZIAŁAJĄCY LINK /exec z Apps Script:
    const API_URL = "https://script.google.com/macros/s/AKfycbyC6uffHY5qu-XqKBt-tC01Fh_QNiRiiDrpKKioa8SXW2jiEBJdeEx2ez3t1vcJnkeblw/exec";

    const $ = s => document.querySelector(s);
    const tbody = $('#tbody');
    const statusEl = $('#status');
    const btn = $('#btn');
    const onlyToday = $('#onlyToday');

    btn.addEventListener('click', load);
    onlyToday.addEventListener('change', render);

    let raw = [];

    function fmtDate(s){
      if(!s) return '';
      const d = new Date(s);
      return d.toLocaleString('pl-PL', {hour12:false});
    }
    function pct(x){
      if (x==null || x==='') return '';
      const v = (typeof x==='number') ? x : Number(String(x).replace('%',''))/100;
      return Math.round((v>1? v/100 : v)*100)+'%';
    }
    function isToday(s){
      const d = new Date(s), n = new Date();
      return d.toDateString() === n.toDateString();
    }

    function render(){
      let data = [...raw];
      if(onlyToday.checked) data = data.filter(r => r.date && isToday(r.date));
      data.sort((a,b) => (b.prob||0) - (a.prob||0));

      if(!data.length){
        tbody.innerHTML = '<tr><td colspan="7" class="muted">Brak danych…</td></tr>';
        return;
      }
      tbody.innerHTML = data.map(r => `
        <tr>
          <td>${fmtDate(r.date)}</td>
          <td>${r.league||''}</td>
          <td>${r.home||''}</td>
          <td>${r.away||''}</td>
          <td>${r.typ||''}</td>
          <td class="right">${pct(r.prob)}</td>
          <td>${r.status||''}</td>
        </tr>
      `).join('');
    }

    async function load(){
      btn.disabled = true;
      statusEl.textContent = 'Ładowanie…';

      try{
        const url = API_URL + (API_URL.includes('?')?'&':'?') + 't=' + Date.now();
        const res = await fetch(url, { cache:'no-store' });
        if(!res.ok) throw new Error('HTTP '+res.status);
        raw = await res.json();
        statusEl.innerHTML = '<span class="ok badge">OK</span> '+
          new Date().toLocaleString('pl-PL',{hour12:false});
        render();
      }catch(err){
        statusEl.innerHTML = '<span class="err">Błąd pobierania danych: '+err.message+'</span>';
        tbody.innerHTML = '<tr><td colspan="7" class="muted">Brak danych…</td></tr>';
      }finally{
        btn.disabled = false;
      }
    }

    load();
  </script>
</body>
</html>
